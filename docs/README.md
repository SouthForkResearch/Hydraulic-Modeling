# CHaMP Hydraulic Modeling
This Wiki describes the R-code that generates the input files necessary to run hydraulic models for CHaMP sites through Delft 3D flow, as well as the R-code that performs post processing on the Delft 3D Flow output files necessary to generate files suitable for follow on products such as NREI and HSI models.  In addition, a series of QA plots are generated by the R-files.  See sections on Unmeasured Flows and Porous Plates for running models at multiple flows and adding structural elements to flow flow models.


# Overview
In support of efforts to quantify relationships between juvenile salmonid habitat and population dynamics, survey data from the Columbia Habitat Monitoring Program (CHaMP) have been used to develop hydraulic models for the majority of more than 600 reaches at which the CHaMP program collects habitat data.   Hydraulic models are a key linkage being used in CHaMP to relate stream hydraulics to juvenile salmonid population dynamics.

The hydraulic modeling approach weâ€™ve developed aims to provide hydraulic models capable of supporting CHaMP research, in terms of precision accuracy, as well as in the ability to generate unique hydraulic models for more than 600 CHaMP sites, at multiple flow conditions per site.  To date, we have successfully modeled more than 900 CHaMP site / flow condition combinations.

Hydraulic model inputs include digital elevation models (DEM) developed from topographic surveys, estimates of surface roughness based on pebble size distributions, and discharge.  Hydraulic model outputs include velocity vector and depth fields as well as information derived from these fields.  All information used to generate model inputs are generated as part of default CHaMP data collection procedures.

Modeled velocities and depths are, in most cases, in excellent agreement with velocity and depth measured at a subset of sites for which validation data have been collected.  There are exceptions, where certain topographic features such as undercut banks and porous structures, are not well represented in the DEM, resulting modeled values that fail to reflect measured values accurately.  Impacts and strategies for improvement are discussed.

Overall, CHaMP hydraulic models are precise and accurate, and adequately support efforts to link stream hydraulics to habitat conditions.


## Files required for each Visit_ID x Flow to be modeled ##
* DEM.csv: this .csv file contains all bathymetry information from the site Visit_ID.
* WSEDEM.csv this .csv file contains the water surface elevation for the Visit_ID.  This information is used to define the downstream boundary condition, as well as to compare modeled water surface elevation to measured water surface elevation
* Thalweg.csv: the thalweg is used to determine the location of the upstream and downstream boundaries (which are forced to be one of the four cardinal directions).

## R Code Files ##
* Build_Input_Files.R: Convert the input files DEM.csv, WSEDEM.csv, and Thalweg.csv for each Visit_ID and flow combinations into a series of input files needed to run Delft 3D Flow.  A series of QA plots, including a file illustrating the boundary conditions, is also produced.

* Post_Processing.R: Take the Delft-3D results and interpolate them back onto the same grid locations as found in the original DEM.csv file.  Generate an output file "dem_grid_results.csv", an xml file "summary.xml", a metadata file "Meta_Data.csv", and a series of jpg file.


## Additional Input Files ##
* CFD_Site_List.csv: This file lists the Visit_ID's and flows to be modeled, as well as the directories in which the input files are located for each modeling run.  In addition, the input parameters D84, roughness, measured discharge, modeled discharge are specified.  Also, numerical modeling parameters "trim length" and "HEV" are specified here (more info on these below).



## Additional Information ##
Consult the file "CHaMP Hydraulic Modeling.docx" for complete mode descriptions and information.

Consult the Delft 3D flow home pages at http://oss.deltares.nl/web/delft3d for more information on the Delft 3D flow program, including access to required source code needed to run 3D-Flow.
